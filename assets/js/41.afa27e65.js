(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{340:function(t,s,a){"use strict";a.r(s);var e=a(13),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"css-性能优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#css-性能优化"}},[t._v("#")]),t._v(" CSS 性能优化")]),t._v(" "),s("h2",{attrs:{id:"内联首屏关键css-critical-css"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内联首屏关键css-critical-css"}},[t._v("#")]),t._v(" 内联首屏关键CSS（Critical CSS）")]),t._v(" "),s("p",[t._v("内联CSS能够使浏览器开始页面渲染的时间提前，减少FCP的时间。")]),t._v(" "),s("p",[s("strong",[t._v("劣势")]),t._v("：")]),t._v(" "),s("p",[t._v("内联之后的CSS不会进行缓存，每次都会重新下载，因此应当控制内联CSS的大小。")]),t._v(" "),s("h2",{attrs:{id:"异步加载css"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#异步加载css"}},[t._v("#")]),t._v(" 异步加载CSS")]),t._v(" "),s("h3",{attrs:{id:"使用js创建-link-元素并插入dom"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用js创建-link-元素并插入dom"}},[t._v("#")]),t._v(" 使用JS创建"),s("code",[t._v("<link>")]),t._v("元素并插入DOM")]),t._v(" "),s("p",[t._v("示例如下：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" myCSS "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"link"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmyCSS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rel "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"stylesheet"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmyCSS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mystyles.css"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 插入到header的最后位置")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" insertPosition "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("childNodes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("childNodes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndocument"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("insertBefore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("myCSS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertPosition"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextSibling"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"使用media属性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用media属性"}},[t._v("#")]),t._v(" 使用"),s("code",[t._v("media")]),t._v("属性")]),t._v(" "),s("p",[t._v("将link元素的media属性设置为用户浏览器不匹配的媒体类型（或媒体查询），如"),s("code",[t._v('media="print"')]),t._v("，甚至可以是完全不存在的类型"),s("code",[t._v('media="noexist"')]),t._v("。")]),t._v(" "),s("p",[t._v("对浏览器来说，如果样式表不适用于当前媒体类型，其优先级会被放低，会在不阻塞页面渲染的情况下再进行下载。")]),t._v(" "),s("p",[t._v("而在文件加载完成之后，将media的值设为screen或all，从而让浏览器开始解析CSS。如下所示：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("link rel"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"stylesheet"')]),t._v(" href"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mystyles.css"')]),t._v(" media"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"noexist"')]),t._v(" onload"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"this.media='all'\"")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("p",[t._v("参考"),s("RouterLink",{attrs:{to:"/html/Link_Tag.html"}},[s("link"),t._v("标签")])],1),t._v(" "),s("h3",{attrs:{id:"使用preload属性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用preload属性"}},[t._v("#")]),t._v(" 使用"),s("code",[t._v("preload")]),t._v("属性")]),t._v(" "),s("p",[t._v("使用"),s("code",[t._v("<link>")]),t._v("标签的 rel 属性，将值指定为"),s("code",[t._v('"preload"')]),t._v("。")]),t._v(" "),s("blockquote",[s("p",[t._v("关键字 "),s("code",[t._v("preload")]),t._v(" 作为元素 "),s("code",[t._v("<link>")]),t._v(" 的属性 rel 的值，表示用户十分有可能需要在当前浏览中加载目标资源，所以浏览器必须预先获取和缓存对应资源。")])]),t._v(" "),s("p",[s("strong",[t._v("注意")]),t._v("：preload 属性值需要搭配 "),s("code",[t._v("as")]),t._v(" 属性指定类型，否则可能会变成普通的XHR请求，示例如下：")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("preload"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("mystyles.css"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("as")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token special-attr"}},[s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onload")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),s("span",{pre:!0,attrs:{class:"token value javascript language-javascript"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rel"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'stylesheet'")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("关于"),s("code",[t._v("<link>")]),t._v("元素，参考"),s("RouterLink",{attrs:{to:"/html/Link_Tag.html"}},[s("link"),t._v("标签")])],1),t._v(" "),s("h2",{attrs:{id:"文件压缩"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#文件压缩"}},[t._v("#")]),t._v(" 文件压缩")]),t._v(" "),s("p",[t._v("使用 webpack 等工具压缩 CSS 文件体积")]),t._v(" "),s("h2",{attrs:{id:"有选择地使用选择器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#有选择地使用选择器"}},[t._v("#")]),t._v(" 有选择地使用选择器")]),t._v(" "),s("p",[t._v("CSS选择器的匹配是"),s("strong",[t._v("从右向左")]),t._v("进行的，这一策略导致了不同种类的选择器之间的性能也存在差异。")]),t._v(" "),s("p",[t._v("相比于"),s("code",[t._v("#markdown-content-h3")]),t._v("，显然使用"),s("code",[t._v("#markdown .content h3")]),t._v("时，浏览器生成渲染树（render-tree）所要花费的时间更多。因为后者需要先找到DOM中的所有h3元素，再过滤掉祖先元素不是"),s("code",[t._v(".content")]),t._v("的，最后过滤掉"),s("code",[t._v(".content")]),t._v("的祖先不是"),s("code",[t._v("#markdown")]),t._v("的。")]),t._v(" "),s("p",[t._v("如果嵌套的层级更多，页面中的元素更多，那么匹配所要花费的时间代价自然更高。")]),t._v(" "),s("p",[t._v("提高CSS性能的几点可行建议：")]),t._v(" "),s("ul",[s("li",[t._v("保持简单，不要使用嵌套过多过于复杂的选择器。")]),t._v(" "),s("li",[s("strong",[t._v("通配符")]),t._v("和"),s("strong",[t._v("属性选择器")]),t._v("效率最低，需要匹配的元素最多，尽量避免使用。")]),t._v(" "),s("li",[t._v("不要使用类选择器和ID选择器修饰元素标签，如 "),s("code",[t._v("h3#markdown-content")]),t._v(" ，这样多此一举，还会降低效率。")]),t._v(" "),s("li",[t._v("不要为了追求速度而放弃可读性与可维护性。")])]),t._v(" "),s("h2",{attrs:{id:"优化重排与重绘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化重排与重绘"}},[t._v("#")]),t._v(" 优化重排与重绘")]),t._v(" "),s("p",[t._v("参考："),s("RouterLink",{attrs:{to:"/browser/Reflow_Repaint.html"}},[t._v("回流与重绘")])],1),t._v(" "),s("h3",{attrs:{id:"减少重排-reflow"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#减少重排-reflow"}},[t._v("#")]),t._v(" 减少重排（reflow）")]),t._v(" "),s("ul",[s("li",[t._v("常见的会导致重排的操作：")]),t._v(" "),s("li",[t._v("改变 font-size 和 font-family")]),t._v(" "),s("li",[t._v("改变元素的内外边距")]),t._v(" "),s("li",[t._v("通过JS改变CSS类")]),t._v(" "),s("li",[t._v("通过JS获取DOM元素的位置相关属性（如width/height/left等）")]),t._v(" "),s("li",[t._v("CSS伪类激活")]),t._v(" "),s("li",[t._v("滚动滚动条或者改变窗口大小")])]),t._v(" "),s("h3",{attrs:{id:"避免不必要的重绘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#避免不必要的重绘"}},[t._v("#")]),t._v(" 避免不必要的重绘")]),t._v(" "),s("p",[t._v("当元素的外观（如color，background，visibility等属性）发生改变时，会触发重绘。")]),t._v(" "),s("p",[t._v("举例：滚动时禁用 hover 事件")]),t._v(" "),s("h3",{attrs:{id:"不要使用-import"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#不要使用-import"}},[t._v("#")]),t._v(" 不要使用 "),s("code",[t._v("@import")])]),t._v(" "),s("p",[t._v("使用"),s("code",[t._v("@import")]),t._v(" 引入CSS会影响浏览器的并行下载。")]),t._v(" "),s("p",[t._v("使用 "),s("code",[t._v("@import")]),t._v(" 引用的CSS文件只有在引用它的那个css文件被下载、解析之后，浏览器才会知道还有另外一个css需要下载，这时才去下载，然后下载后开始解析、构建render tree等一系列操作。这就导致浏览器无法并行下载所需的样式文件。")])])}),[],!1,null,null,null);s.default=n.exports}}]);